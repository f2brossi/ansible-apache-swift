- hosts: apacheproxy

  tasks:
  - name: create-directories
    shell: mkdir -p {{ item }}
    with_items:
     - /etc/apache2/ssl/crt

  - name: copy-ssl-certs
    copy: src=files/{{ item.name }} dest={{ item.dest }} owner=root group=root mode=400
    with_items:
     - { name: 'ssl-cert-snakeoil.pem', dest: '/etc/ssl/certs/ssl-cert-snakeoil.pem' },
     - { name: 'ssl-cert-snakeoil.key', dest: '/ets/ssl/private/ssl-cert-snakeoil.key'}	


  - name: deploy-conf
    template: src=templates/{{ item.tpl }} dest={{ item.file }} backup=yes
    with_items:
     - { tpl: 'apache/site.conf.j2', file: '/etc/apache2/sites-available/default-ssl' }
 
